@rendermode InteractiveServer
@using rntlOS.FrontOffice.Services
@inject AuthenticationStateService AuthService
@inject NavigationManager Navigation
@implements IDisposable

<div class="top-row ps-3 navbar">
    <div class="container-fluid">
        <a class="navbar-brand" href="">
            <span style="font-weight: 300; color: #fff;">rntl</span><strong style="color: var(--gold-primary);">OS</strong>
        </a>
    </div>
</div>

<nav class="flex-column">
    <div class="nav-item">
        <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
            <span class="oi oi-home" aria-hidden="true"></span> Accueil
        </NavLink>
    </div>
    <div class="nav-item">
        <NavLink class="nav-link" href="vehicules">
            <span class="oi oi-list" aria-hidden="true"></span> Véhicules
        </NavLink>
    </div>
    
    @if (AuthService?.IsAuthenticated == true)
    {
        <!-- USER CONNECTÉ -->
        <div class="nav-item mt-4">
            <div class="user-info">
                <div class="user-avatar">
                   <span class="oi oi-person"></span>
                </div>
                <div class="user-details">
                    <div class="user-name">@AuthService.CurrentUser?.Prenom @AuthService.CurrentUser?.Nom</div>
                    <div class="user-email">@AuthService.CurrentUser?.Email</div>
                </div>
            </div>
        </div>
        <div class="nav-item">
            <NavLink class="nav-link" href="mes-reservations">
                <span class="oi oi-calendar"></span> Mes réservations
            </NavLink>
        </div>
        <div class="nav-item mt-2">
            <button class="btn btn-logout w-100" @onclick="Logout">
                <span class="oi oi-account-logout"></span> Déconnexion
            </button>
        </div>
    }
    else
    {
        <!-- NON CONNECTÉ -->
        <div class="nav-item">
            <NavLink class="nav-link" href="login">
                <span class="oi oi-person" aria-hidden="true"></span> Connexion
            </NavLink>
        </div>
    }
</nav>

@code {
    protected override void OnInitialized()
    {
        AuthService.OnAuthStateChanged += StateHasChanged;
    }

    private void Logout()
    {
        AuthService.Logout();
        Navigation.NavigateTo("/");
    }

    public void Dispose()
    {
        AuthService.OnAuthStateChanged -= StateHasChanged;
    }
}

